# テスト手順ガイド

ビルドが完了したアプリケーションをテストするための手順です。

## 📋 前提条件

- ✅ ビルドが完了していること (`dist\SummaryForDoc\SummaryForDoc.exe` が存在)
- ✅ APIキーの準備（Anthropic Claude または OpenAI）

## 🧪 テスト手順

### 1. アプリケーションの起動

```cmd
cd dist\SummaryForDoc
SummaryForDoc.exe
```

**確認ポイント:**
- ✅ アプリケーションウィンドウが表示される
- ✅ エラーダイアログが表示されない
- ✅ UIが正常にレンダリングされている

### 2. APIキーの設定

1. サイドバーの「⚙️ 設定」をクリック
2. 使用するAI APIを選択:
   - **Claude (Anthropic)** - 推奨
   - **GPT (OpenAI)**
3. APIキーを入力
4. 「保存」ボタンをクリック

**確認ポイント:**
- ✅ APIキーが入力できる
- ✅ 保存が成功する（`.env`ファイルが作成される）

### 3. ファイル選択機能のテスト

#### テスト A: テキストファイル (.txt)

1. 「📁 ファイルを選択」ボタンをクリック
2. テキストファイルを選択（`tests\sample.txt` など）
3. ファイルが追加されることを確認

**確認ポイント:**
- ✅ ファイル選択ダイアログが開く
- ✅ 選択したファイルがリストに表示される
- ✅ ファイル名と形式が正しく表示される

#### テスト B: PDFファイル (.pdf)

1. 「📁 ファイルを選択」ボタンをクリック
2. PDFファイルを選択
3. ファイルが追加されることを確認

**確認ポイント:**
- ✅ PDFファイルが認識される
- ✅ ファイルサイズが表示される

#### テスト C: 画像ファイル (.jpg / .png)

**重要**: 画像ファイルはOCR処理が必要です

1. 「📁 ファイルを選択」ボタンをクリック
2. 画像ファイルを選択（日本語テキストが含まれる画像）
3. ファイルが追加されることを確認

**確認ポイント:**
- ✅ 画像ファイルが認識される
- ✅ Tesseractが正常に動作する（エラーが出ない）

### 4. 複数ファイルの選択テスト

1. 「📁 ファイルを選択」ボタンをクリック
2. **Ctrlキー**を押しながら複数ファイルを選択
3. すべてのファイルが追加されることを確認

**確認ポイント:**
- ✅ 複数ファイルが同時に追加できる
- ✅ 各ファイルが個別にリスト表示される

### 5. 個人情報削除と要約生成のテスト

#### 準備: テストファイルの作成

以下の内容でテキストファイルを作成 (`test_sample.txt`):

```
患者情報
氏名: 山田太郎
生年月日: 1980年5月15日
住所: 東京都渋谷区代々木1-2-3
電話番号: 03-1234-5678

病歴:
2020年4月から抑うつ症状が出現。不眠、食欲低下、集中力の低下が続いている。
2020年5月に当院を受診し、うつ病と診断された。
抗うつ薬による治療を開始したが、症状の改善は緩徐である。
```

#### テスト手順:

1. 上記のテストファイルを選択
2. **要約の種類**を選択:
   - ☑️ 病歴（200-300文字）
   - ☑️ 症状の詳細（200-300文字）
   - ☑️ 全期間サマリー（詳細版）
3. **テンプレート**を選択（例: 障害年金診断書）
4. 「🤖 個人情報を削除して要約作成」ボタンをクリック
5. 処理が完了するまで待機（数秒〜数十秒）

**確認ポイント:**
- ✅ 個人情報（氏名、生年月日、住所、電話番号）が削除されている
- ✅ 病歴と症状が要約されている
- ✅ 文字数が指定範囲内（200-300文字）
- ✅ 結果がテキストエリアに表示される

#### 期待される出力例:

**個人情報削除後:**
```
患者情報
氏名: [氏名]
生年月日: [生年月日]
住所: [住所]
電話番号: [電話番号]

病歴:
2020年4月から抑うつ症状が出現。不眠、食欲低下、集中力の低下が続いている。
2020年5月に当院を受診し、うつ病と診断された。
抗うつ薬による治療を開始したが、症状の改善は緩徐である。
```

**要約結果:**
- 病歴と症状が簡潔にまとめられている
- 時系列順に整理されている
- 医療専門用語が適切に使用されている

### 6. ファイル保存とコピー機能のテスト

#### テスト A: ファイル保存

1. 要約作成後、「💾 ファイル保存」ボタンをクリック
2. 保存先を選択
3. ファイルが保存されることを確認

**確認ポイント:**
- ✅ ファイル保存ダイアログが開く
- ✅ ファイルが正常に保存される
- ✅ 保存したファイルを開いて内容を確認できる

#### テスト B: クリップボードコピー

1. 要約作成後、「📋 コピー」ボタンをクリック
2. テキストエディタ（メモ帳など）を開く
3. Ctrl+V で貼り付け

**確認ポイント:**
- ✅ 要約結果がクリップボードにコピーされる
- ✅ 他のアプリケーションに貼り付けられる
- ✅ 文字化けが発生しない

### 7. テンプレート切り替えのテスト

1. 「障害年金診断書」テンプレートで要約作成
2. 同じファイルで「精神障害者保健福祉手帳」テンプレートに切り替え
3. 再度要約作成
4. 結果の違いを確認

**確認ポイント:**
- ✅ テンプレートによって要約の内容が変わる
- ✅ 各テンプレートに適した形式で出力される

### 8. OCR機能のテスト（画像ファイル）

#### 準備: テスト画像の作成

日本語テキストが含まれる画像ファイルを準備:
- スクリーンショット
- スキャンした文書
- 写真に撮った文書

**推奨**: 鮮明で読みやすい画像

#### テスト手順:

1. 画像ファイルを選択
2. 要約作成を実行
3. OCRで抽出されたテキストを確認

**確認ポイント:**
- ✅ 画像から日本語テキストが抽出される
- ✅ OCR精度が許容範囲内（主要な単語が認識されている）
- ✅ 抽出されたテキストが要約される

**注意**: OCR精度は画像の品質に依存します。不鮮明な画像では精度が低下します。

## ❌ エラーケースのテスト

### エラー A: APIキー未設定

1. APIキーを設定せずに要約作成を実行
2. エラーメッセージが表示されることを確認

**期待される動作:**
- ✅ 「APIキーが設定されていません」というエラーが表示される
- ✅ アプリがクラッシュしない

### エラー B: 無効なAPIキー

1. 間違ったAPIキーを設定
2. 要約作成を実行
3. エラーメッセージが表示されることを確認

**期待される動作:**
- ✅ 「APIキーが無効です」というエラーが表示される
- ✅ エラー詳細が表示される

### エラー C: サポートされていないファイル形式

1. `.docx` や `.xlsx` などのサポートされていないファイルを選択しようとする
2. 適切なメッセージが表示されることを確認

**期待される動作:**
- ✅ ファイル選択ダイアログで該当ファイルが表示されない（フィルタリング）
- ✅ または選択時にエラーメッセージが表示される

### エラー D: Tesseractが見つからない（OCR失敗）

**注意**: 通常は発生しません（ビルド時に統合済み）

1. OCRを必要とする画像ファイルを選択
2. エラーが発生する場合はログを確認

**期待される動作:**
- ✅ Tesseractが見つからない場合、エラーメッセージが表示される
- ✅ エラー内容が明確に示される

## 📊 テスト結果の記録

以下のチェックリストを使用してテスト結果を記録してください:

### 基本機能
- [ ] アプリケーション起動
- [ ] APIキー設定
- [ ] テキストファイル読み込み
- [ ] PDFファイル読み込み
- [ ] 画像ファイル読み込み
- [ ] 複数ファイル選択

### 要約機能
- [ ] 個人情報削除
- [ ] 病歴要約生成（200-300文字）
- [ ] 症状詳細要約生成（200-300文字）
- [ ] 全期間サマリー生成
- [ ] テンプレート切り替え

### 出力機能
- [ ] ファイル保存
- [ ] クリップボードコピー

### OCR機能
- [ ] 画像からテキスト抽出（日本語）
- [ ] 画像からテキスト抽出（英語）

### エラーハンドリング
- [ ] APIキー未設定エラー
- [ ] 無効なAPIキーエラー
- [ ] ファイル形式エラー

## 🐛 バグ報告

テスト中に問題を発見した場合、以下の情報を記録してください:

1. **再現手順**: 問題が発生するまでの操作手順
2. **期待される動作**: 本来どう動作すべきか
3. **実際の動作**: 実際に何が起こったか
4. **エラーメッセージ**: 表示されたエラー（スクリーンショット推奨）
5. **環境情報**:
   - Windowsバージョン
   - Python バージョン
   - アプリバージョン

## 📝 次のステップ

テストが完了したら:

1. ✅ すべての基本機能が動作することを確認
2. ✅ バグや問題点を記録
3. ✅ 必要に応じて修正や改善を実施
4. 🎉 アプリケーションを実際に使用開始！

## 🚀 本番使用時の注意事項

- ⚠️ **個人情報削除は100%完璧ではありません。必ず目視確認してください。**
- ⚠️ API料金がかかります（1回数円〜十数円程度）
- ⚠️ OCR精度は画像の質に依存します。鮮明な画像を使用してください。
- ⚠️ 生成された要約は医師による最終確認が必要です。

## 📖 関連ドキュメント

- [README.md](README.md) - プロジェクト概要
- [WINDOWS_BUILD.md](WINDOWS_BUILD.md) - ビルド手順
- [TESSERACT_JAPANESE_INSTALL.md](TESSERACT_JAPANESE_INSTALL.md) - Tesseract日本語データのインストール
